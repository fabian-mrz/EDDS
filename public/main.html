<!DOCTYPE html>
<html>

<head>
    <style>
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(255, 255, 0, 0.7);
            }

            70% {
                box-shadow: 0 0 0 10px rgba(255, 255, 0, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(255, 255, 0, 0);
            }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        * {
            /* This will apply a transition to all properties of all elements */
            transition: all 0.5s ease;
        }

        body {
            /* Radial gradient from light gray at the center to dark gray at the edges */
            background: radial-gradient(circle at center, #515151, #1a1a1a);
            font-family: 'Arial', sans-serif;
            color: white;
        }

        .container {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            height: 100%;
        }

        .player {
            width: 168px;
            height: 202px;
            /* increased height to accommodate player name */
            text-align: center;
            margin: 14px;
        }

        .player-name {
            margin-bottom: 0;
            font-size: 20px;
        }

        .score-box {
            background-color: #262672;
            width: 168px;
            height: 168px;
            border: 1px solid rgb(0, 0, 0);
            margin-top: 5%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #unique-score-box {
            width: 300px;
            /* Setzt die Breite auf 300px */
            height: 300px;
            /* Setzt die Höhe auf 300px */
        }

        .score-box p {
            font-size: 9em;
            /* adjust as needed */
            font-weight: bold;
        }

        .container {
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            /* Ändert die Ausrichtung der Elemente zum Ende des Containers */
            align-items: center;
            width: 100%;
            height: 100%;
            position: absolute;
            bottom: 0;
        }

        .players-container {
            display: flex;
            justify-content: center;
            height: 40%;
            flex-wrap: wrap;
            margin-top: 1%;
            /* Fügt Abstand oberhalb der Player-Boxen hinzu */
        }

        .song-title {
            background-color: #262672;
            max-width: 100%;
            width: 100%;
            height: 10%;
            min-height: 10%;
            border: 1px solid black;
            text-align: center;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            padding: 1%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin-bottom: 5%;
            /* Fügt Abstand unterhalb des Songtitels hinzu */
        }

        .song-title p {
            font-weight: bold;
            font-size: x-large;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="album-cover">
            <div class="score-box" id="unique-score-box"
                style="background-image: url('cover.png'); background-size: cover;"></div>
        </div>
        <div class="players-container">
            <div class="player">
                <p class="player-name">Spieler1</p>
                <div class="score-box" id="buzzer1">
                    <p class="player-score">0</p>
                </div>
            </div>
            <div class="player">
                <p class="player-name">Spieler2</p>
                <div class="score-box" id="buzzer2">
                    <p class="player-score">0</p>
                </div>
            </div>
            <div class="player">
                <p class="player-name">Spieler 3</p>
                <div class="score-box" id="buzzer3">
                    <p class="player-score">0</p>
                </div>
            </div>
            <div class="player">
                <p class="player-name">Spieler 4</p>
                <div class="score-box" id="buzzer4">
                    <p class="player-score">0</p>
                </div>
            </div>
        </div>
        <div class="song-title">
            <p id="song-title"></p>
            <p id="artist-name"></p>
        </div>
    </div>


    <script>
        window.onload = function () {
            var playersContainer = document.querySelector('.players-container');
            var songTitle = document.querySelector('.song-title');

            if (playersContainer && songTitle) {
                songTitle.style.width = getComputedStyle(playersContainer).width;
            }
        }

        const socket = new WebSocket('ws://192.168.178.45:8081');

        let albumCoverUrl = 'cover.png';
        let trackName = '';
        let artistName = '';

        socket.addEventListener('message', (event) => {
            const data = JSON.parse(event.data);

            console.log('Received data:', data);

            if (data.type == "buzzer-pressed") {
                console.log('Buzzer pressed by:', data.buzzer);
                // Find the score box of the player who pressed the buzzer
                let scoreBox = document.getElementById(data.buzzer);
                // Change the border color based on the pressed value
                if (scoreBox) {
                    switch (data.pressed) {
                        case "pressed":
                            scoreBox.style.borderColor = 'yellow';
                            scoreBox.classList.add('pulse');
                            break;
                        case true:
                            scoreBox.classList.remove('pulse');
                            scoreBox.style.borderColor = 'green';
                            setTimeout(() => {
                                scoreBox.style.borderColor = '';
                            }, 5000);
                            break;
                        case false:
                            scoreBox.classList.remove('pulse');
                            scoreBox.style.borderColor = 'red';
                            setTimeout(() => {
                                scoreBox.style.borderColor = '';
                            }, 5000);
                            break;
                    }
                }
            }

            if (data.type === 'players-updated') {
                const playerNameElements = document.querySelectorAll('.player-name');
                const playerScoreElements = document.querySelectorAll('.score-box p');
                data.players.forEach((player, index) => {
                    if (playerNameElements[index]) {
                        playerNameElements[index].textContent = player.name || '';
                    }
                    if (playerScoreElements[index]) {
                        playerScoreElements[index].textContent = player.score || 0;
                    }
                });
            }

            if (data.albumCoverUrl) {
                albumCoverUrl = data.albumCoverUrl;
            }
            if (data.trackName) {
                trackName = data.trackName;
            }
            if (data.artistName) {
                artistName = data.artistName;
            }

            const songTitleDiv = document.getElementById('song-title');
            const artistNameDiv = document.getElementById('artist-name');
            const scoreBoxDiv = document.querySelector('.score-box');

            if (songTitleDiv && artistNameDiv && scoreBoxDiv) {
                if (data.songGuessed) {
                    songTitleDiv.innerHTML = trackName;
                    artistNameDiv.innerHTML = artistName;
                    scoreBoxDiv.style.backgroundImage = `url('${albumCoverUrl}')`;
                } else {
                    songTitleDiv.innerHTML = '';
                    artistNameDiv.innerHTML = '';
                    scoreBoxDiv.style.backgroundImage = "url('cover.png')";
                }
            }
        });
    </script>
</body>

</html>