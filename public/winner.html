<!DOCTYPE html>
<html>

<head>
    <title>Song Quiz - Winner</title>
    <link rel="stylesheet" href="/css/styles.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        .winner-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 2rem;
            background: radial-gradient(circle at center, rgba(29, 185, 84, 0.15) 0%, rgba(29, 185, 84, 0.05) 50%, rgba(0, 0, 0, 0.02) 100%);
            position: relative;
            overflow: hidden;
        }

        .trophy {
            font-size: clamp(6rem, 15vw, 12rem);
            margin-bottom: 2rem;
            animation: float 3s ease-in-out infinite;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
        }

        .winner-text {
            font-size: clamp(2rem, 8vw, 4rem);
            font-weight: 800;
            color: var(--spotify-black);
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            animation: slideIn 1s ease-out;
        }

        .winner-score {
            font-size: clamp(1.5rem, 6vw, 3rem);
            color: var(--spotify-green);
            margin-bottom: 2rem;
            font-weight: bold;
            animation: slideIn 1s ease-out 0.2s backwards;
        }

        .confetti {
            position: fixed;
            width: 15px;
            height: 15px;
            background-color: var(--spotify-green);
            clip-path: polygon(50% 0%, 90% 20%, 100% 60%, 75% 100%, 25% 100%, 0% 60%, 10% 20%);
            animation: confetti 4s ease-in-out infinite;
        }

        .glow {
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, rgba(29, 185, 84, 0.2) 0%, transparent 70%);
            animation: pulse 4s ease-in-out infinite;
        }

        /* Winner podium layout */

        .podium-container {
            --podium-height: 36rem;
            /* Change this to scale everything */
            --step-width: calc(var(--podium-height) / 2.2);
            --step-radius: calc(var(--podium-height) / 7);
            --step-font: calc(var(--podium-height) / 14);
            --step-padding: calc(var(--podium-height) / 12);
            --step-gap: calc(var(--podium-height) / 24);

            display: flex;
            justify-content: center;
            align-items: flex-end;
            gap: var(--step-gap);
            height: var(--podium-height);
            margin: 7rem auto;
            position: relative;
        }

        .podium-step {
            margin-left: calc(var(--step-gap) * -1);
            margin-right: calc(var(--step-gap) * -1);
            display: flex;
            align-items: center;
            justify-content: center;
            width: var(--step-width);
            border-radius: var(--step-radius) var(--step-radius) 0 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.85) 60%, rgba(220, 220, 220, 0.7) 100%);
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.14);
            font-size: var(--step-font);
            font-weight: 700;
            letter-spacing: 0.04em;
            opacity: 0;
            transform: translateY(80px) scale(0.92);
            filter: blur(8px);
            transition:
                opacity 0.8s cubic-bezier(.77, 0, .18, 1),
                transform 0.8s cubic-bezier(.77, 0, .18, 1),
                filter 0.8s cubic-bezier(.77, 0, .18, 1),
                box-shadow 0.5s;
            padding: var(--step-padding) 0 calc(var(--step-padding) * 0.7) 0;
            text-align: center;
            backdrop-filter: blur(2px);
            position: relative;
            overflow: hidden;
        }

        .podium-1 {
            order: 2;
            height: calc(var(--podium-height) * 0.7);
            font-size: calc(var(--podium-height) / 11);
            border: 4px solid #FFD700;
            color: #FFD700;

            font-weight: 800;
            z-index: 2;
            box-shadow: 0 0 80px 0 #FFD70044;
        }

        .podium-2 {
            order: 1;
            height: calc(var(--podium-height) * 0.43);
            font-size: calc(var(--podium-height) / 18);
            border: 4px solid #c0c0c0;
            color: #c0c0c0;
            z-index: 1;
        }

        .podium-3 {
            order: 3;
            height: calc(var(--podium-height) * 0.28);
            font-size: calc(var(--podium-height) / 16);
            border: 4px solid #b08d57;
            color: #b08d57;
            z-index: 0;
        }

        @media (max-width: 900px) {
            .podium-container {
                --podium-height: 22rem;
            }
        }

        @media (max-width: 600px) {
            .podium-container {
                --podium-height: 14rem;
            }
        }

        /* Winner Glow Animation */
        .podium-1.epic {
            box-shadow: 0 0 80px 20px #FFD70088, 0 0 0 0 #FFD700;
            animation: winnerGlow 1.5s cubic-bezier(.77, 0, .18, 1) 1;
        }

        @keyframes winnerGlow {
            0% {
                box-shadow: 0 0 0 0 #FFD700;
            }

            60% {
                box-shadow: 0 0 80px 20px #FFD70088, 0 0 0 0 #FFD700;
            }

            100% {
                box-shadow: 0 0 60px 0 #FFD70044;
            }
        }

        /* Confetti burst */
        .confetti {
            position: fixed;
            width: 16px;
            height: 16px;
            background-color: var(--spotify-green);
            border-radius: 50%;
            opacity: 0.85;
            pointer-events: none;
            z-index: 9999;
            animation: confettiBurst 1.8s cubic-bezier(.77, 0, .18, 1) forwards;
        }

        @keyframes confettiBurst {
            0% {
                transform: translateY(-10vh) scale(1) rotate(0deg);
                opacity: 1;
            }

            80% {
                opacity: 1;
            }

            100% {
                transform: translateY(100vh) scale(0.7) rotate(720deg);
                opacity: 0;
            }
        }

        .podium-1.pulse {
            animation: winnerPulse 1.2s cubic-bezier(.77, 0, .18, 1) infinite;
        }

        @keyframes winnerPulse {

            0%,
            100% {
                transform: scale(1);
                box-shadow: 0 0 60px 0 #FFD70044;
            }

            50% {
                transform: scale(1.06);
                box-shadow: 0 0 90px 10px #FFD70088;
            }
        }


        @keyframes float {

            0%,
            100% {
                transform: translateY(0) rotate(0deg);
            }

            50% {
                transform: translateY(-20px) rotate(5deg);
            }
        }

        @keyframes confetti {
            0% {
                transform: translateY(-10vh) rotate(0deg) scale(1);
                opacity: 1;
            }

            100% {
                transform: translateY(100vh) rotate(720deg) scale(0.5);
                opacity: 0;
            }
        }

        @keyframes slideIn {
            from {
                transform: translateY(30px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
                opacity: 0.5;
            }

            50% {
                transform: scale(1.1);
                opacity: 0.8;
            }
        }
    </style>
</head>

<body>
    <div class="podium-container">
        <div class="podium-step podium-2" id="place2"></div> <!-- 2nd place: left -->
        <div class="podium-step podium-1" id="place1"></div> <!-- 1st place: middle -->
        <div class="podium-step podium-3" id="place3"></div> <!-- 3rd place: right -->
    </div>

    <script>
        const wsHost = "127.0.0.1";
        const wsPort = "8081";
        const ws = new WebSocket(`ws://${wsHost}:${wsPort}`);

        ws.onmessage = function (event) {
            const data = JSON.parse(event.data);
            if (data.type === 'clear-session') {
                document.cookie = 'playerId=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/';
                document.cookie = 'playerName=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/';
                window.location.href = data.redirect;
            }
        };

        showTop3();

        function showTop3() {
            fetch('/get-top3')
                .then(response => response.json())
                .then(data => {
                    if (data.top3 && data.top3.length > 0) {
                        animateTop3(data.top3);
                    }
                })
                .catch(error => {
                    console.error('Error fetching top 3:', error);
                    window.location.href = '/index.html';
                });
        }

        function animateTop3(top3) {
            while (top3.length < 3) top3.push({ name: '' });

            const place1 = document.getElementById('place1');
            const place2 = document.getElementById('place2');
            const place3 = document.getElementById('place3');

            [place1, place2, place3].forEach(el => {
                el.style.opacity = 0;
                el.style.transform = "translateY(80px) scale(0.92)";
                el.style.filter = "blur(8px)";
                el.classList.remove('epic', 'pulse');
                el.textContent = '';
            });

            // 3rd place (right)
            place3.textContent = top3[2].name;
            setTimeout(() => {
                place3.style.opacity = 1;
                place3.style.transform = "translateY(0) scale(1)";
                place3.style.filter = "blur(0)";
                // 2nd place (left)
                place2.textContent = top3[1].name;
                setTimeout(() => {
                    place2.style.opacity = 1;
                    place2.style.transform = "translateY(0) scale(1)";
                    place2.style.filter = "blur(0)";
                    // 1st place (middle)
                    place1.textContent = top3[0].name;
                    setTimeout(() => {
                        place1.style.opacity = 1;
                        place1.style.transform = "scale(1.12)";
                        place1.style.filter = "blur(0)";
                        place1.classList.add('epic');
                        setTimeout(() => {
                            place1.style.transform = "scale(1)";
                            createConfettiLong();
                            // Add pulse after confetti starts
                            setTimeout(() => {
                                place1.classList.add('pulse');
                            }, 800);
                        }, 900);
                    }, 1700);
                }, 1700);
            }, 1200);
        }

        // Longer confetti burst for winner
        function createConfettiLong() {
            const colors = ['#FFD700', '#1DB954', '#FF69B4', '#00CED1', '#FFA500'];
            const duration = 4000; // 4 seconds
            const interval = 120;
            let startTime = Date.now();

            const confettiRain = setInterval(() => {
                for (let i = 0; i < 8; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = (50 + Math.random() * 40 - 20) + 'vw';
                    confetti.style.top = (20 + Math.random() * 10) + 'vh';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = (Math.random() * 0.7) + 's';
                    document.body.appendChild(confetti);
                    setTimeout(() => confetti.remove(), 2200);
                }
                if (Date.now() - startTime > duration) {
                    clearInterval(confettiRain);
                }
            }, interval);
        }

    </script>
</body>

</html>